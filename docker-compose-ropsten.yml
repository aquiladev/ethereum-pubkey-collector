version: '3'

services:
  # Set up as many of these as networks you want to collect keys for
  # This is an example of a ropsten node
    geth:
      image: ethereum/client-go
      volumes:
        - $HOME/.ethereum:/root/.ethereum
      command:
        --rpc --rpcaddr "0.0.0.0" --testnet

    api:
      build:
        context: ./api
        dockerfile: api.docker
      ports:
        - "80:5000"

    pkcollector:
       build:
          context: ./pubkey-collector
          dockerfile: pubkey-collector.docker
       environment:
         - CHAINID=3
         - RPCADDR=/chaindata/geth.ipc
       volumes:
         - $HOME/.ethereum/testnet:/chaindata
       depends_on:
          - "geth"
          - "api"
